Bootstrap: docker
From: ubuntu:20.04
Stage: build

%post

    ln -fs /usr/share/zoneinfo/Europe/Rome /etc/localtime
    export DEBIAN_FRONTEND=noninteractive
    echo "export DEBIAN_FRONTEND=noninteractive" >> $SINGULARITY_ENVIRONMENT

    apt-get update
    apt-get install -y --no-install-recommends apt-utils wget git-all
    
    # Install R, Python, misc. utilities
     
    apt-get install -y python3 python3-pip python3-dev graphviz

    apt-get upgrade -y

    # Install required Pyhton packages
   
    pip3 --no-cache-dir install numpy==1.23.5
    pip3 --no-cache-dir install matplotlib==3.7.1
    pip3 --no-cache-dir install pandas==1.5.3
    pip3 --no-cache-dir install antlr4-python3-runtime==4.9.2

    pip3 install -e git+https://github.com/smilies-polito/nwn-snakes.git#egg=snakes

    apt-get clean
    apt-get update -y
    
    
%runscript
    
    #!/bin/sh
    echo "Compiling BiSDL descriptions into nwn-snakes models for $1"
    python3 bisdl2snakes.py examples/$1/$1.bisdl

    echo "Starting petrisim simulation for $1 with $2 simulation steps"
    python3 run_simulation.py $1 $2 
 

